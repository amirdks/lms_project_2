function HaDateTimePicker(e,t){this.target=e,t=t||{};var a=!!t.isSolar&&"true"===t.isSolar.toString().toLowerCase(),i=!!t.isLunar&&"true"===t.isLunar.toString().toLowerCase();this.dpDOM=null,this.eventHandler=document.createElement("DIV"),this.uId="hadp"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)+(new Date).getSeconds();var s=!!t.timePickerOnly&&"true"===t.timePickerOnly.toString().toLowerCase();if(("string"==typeof t.selectedDate||t.selectedDate instanceof String)&&(t.selectedDate="NaN"!==Date.parse(t.selectedDate).toString()?"true"===t.resultInSolar?new HaSolarDate(t.selectedDate):new Date(t.selectedDate):null),this.options={date:t.date||new Date,isSolar:a,isLunar:i,maxYear:t.maxYear||(a===!0?1450:i===!0?1480:2050),minYear:t.minYear||(a===!0?1350:i===!0?1380:1950),pagingDuration:t.pagingDuration||600,selectedDate:t.selectedDate||null,extraTargets:t.extraTargets||null,extraLunarTargets:t.extraLunarTargets||null,extraSolarTargets:t.extraSolarTargets||null,minAllowedDate:t.minAllowedDate||null,maxAllowedDate:t.maxAllowedDate||null,forceSetTime:!!t.forceSetTime&&"true"===t.forceSetTime.toString().toLowerCase(),resultInSolar:!!t.resultInSolar&&"true"===t.resultInSolar.toString().toLowerCase(),resultInLunar:!!t.resultInLunar&&"true"===t.resultInLunar.toString().toLowerCase(),disableTime:!!t.disableTime&&"true"===t.disableTime.toString().toLowerCase(),disableAnimations:!!t.disableAnimations&&"true"===t.disableAnimations.toString().toLowerCase(),timePickerOnly:s,disableOkButton:!!t.disableOkButton&&"true"===t.disableOkButton.toString().toLowerCase(),resultFormat:t.resultFormat||(s?"{hour}:{minute} {ampm}":"{month}/{day}/{year} {t?{hour}:{minute} {ampm}}"),disabledWeekDays:t.disabledWeekDays||null},this.options.timePickerOnly?this.clock=!0:this.clock=!1,this.options.disabledWeekDays){this.options.disabledWeekDays.constructor===Array&&this.options.disabledWeekDays instanceof Array&&!this||(this.options.disabledWeekDays=this.options.disabledWeekDays.split(","));for(var o=0;o<this.options.disabledWeekDays.length;o++)this.options.disabledWeekDays[o]=Number(this.options.disabledWeekDays[o].toString()),7==this.options.disabledWeekDays[o]&&this.options.disabledWeekDays.push(0)}"undefined"==typeof HaSolarDate?(this.options.isSolar=!1,this.options.resultInSolar=!1):this.solarDate=new HaSolarDate,"undefined"==typeof HaLunarDate?(this.options.isLunar=!1,this.options.resultInLunar=!1):this.lunarDate=new HaLunarDate,this.options.isSolar?window.HaDateSource=HaSolarDate:this.options.isLunar?window.HaDateSource=HaLunarDate:window.HaDateSource=Date,null!=this.options.selectedDate&&(this.selectedTime={hour:this.options.selectedDate.getHours()>=12?this.options.selectedDate.getHours()-12:this.options.selectedDate.getHours(),minute:this.options.selectedDate.getMinutes(),amOrPm:this.options.selectedDate.getHours()>=12?"pm":"am"}),this.options.isLunar===!0?(this.days=this.lunarDate.dayNames,this.monthNames=this.lunarDate.monthNames,this.renderedDate=this.lunarDate.convertFromGregorian(this.options.date),null!=this.options.selectedDate&&(this.selectedDate=this.options.resultInLunar===!1?this.lunarDate.convertFromGregorian(this.options.selectedDate):new HaLunarDate(this.options.selectedDate.getFullYear(),this.options.selectedDate.getMonth(),this.options.selectedDate.getDate()))):this.options.isSolar===!0?(this.days=this.solarDate.dayNames,this.monthNames=this.solarDate.monthNames,this.renderedDate=this.solarDate.convertFromGregorian(this.options.date),null!=this.options.selectedDate&&(this.selectedDate=this.options.resultInSolar===!1?this.solarDate.convertFromGregorian(this.options.selectedDate):new HaSolarDate(this.options.selectedDate.getFullYear(),this.options.selectedDate.getMonth(),this.options.selectedDate.getDate()))):(this.renderedDate=this.options.date,null!=this.options.selectedDate&&(this.selectedDate=this.options.resultInSolar===!1?this.options.selectedDate:this.solarDate.convertToGregorian(new HaSolarDate(this.options.selectedDate.getFullYear(),this.options.selectedDate.getMonth(),this.options.selectedDate.getDate()))),this.days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"]),this.options.maxAllowedDate&&(this.options.maxAllowedDate=this.options.isSolar?new HaSolarDate(this.options.maxAllowedDate):this.options.isLunar?new HaLunarDate(this.options.maxAllowedDate):new Date(this.options.maxAllowedDate),this.options.maxYear=Math.min(this.options.maxYear,this.options.maxAllowedDate.getFullYear()),this.options.date.compare(this.options.maxAllowedDate,this.renderedDate)>0&&(this.renderedDate=this.options.maxAllowedDate)),this.options.minAllowedDate&&(this.options.minAllowedDate=this.options.isSolar?new HaSolarDate(this.options.minAllowedDate):this.options.isLunar?new HaLunarDate(this.options.minAllowedDate):new Date(this.options.minAllowedDate),this.options.minYear=Math.max(this.options.minYear,this.options.minAllowedDate.getFullYear()),this.options.date.compare(this.options.minAllowedDate,this.options.renderedDate)<0&&(this.renderedDate=this.options.minAllowedDate)),this.options.disableTime===!0&&(this.options.forceSetTime=!1,this.selectedTime=null)}function caseInsensitiveGetAttribute(e,t){for(var a=0;a<e.attributes.length;a++){var i=e.attributes[a];if(t.toLowerCase()===i.name)return i.value}}function twoDigits(e){return e.toString().length<2&&(e="0"+e.toString()),e}function createFragment(e){var t=document.createDocumentFragment(),a=document.createElement("div");for(a.innerHTML=e;a.firstChild;)t.appendChild(a.firstChild);return t}HaDateTimePicker.prototype.init=function(){function e(){return this.replace(/\d+/g,function(e){for(var t="",a=0;a<e.length;a++)t+=String.fromCharCode(e.charCodeAt(a)+1584);return t})}function t(){return this.replace(/\d+/g,function(e){for(var t="",a=0;a<e.length;a++)t+=String.fromCharCode(e.charCodeAt(a)+1728);return t})}document.querySelectorAll(".ha-datetimepicker").length>0&&document.body.removeChild(document.querySelector(".ha-datetimepicker")),this.options.isSolar?window.HaDateSource=HaSolarDate:this.options.isLunar?window.HaDateSource=HaLunarDate:window.HaDateSource=Date,String.prototype.toLocalDigit=this.options.isSolar?t:e,this.createCalendar(),this.setupStyles(),this.createEvents(),this.renderDate(this.selectedDate||this.renderedDate),this.renderClock(),null!=this.selectedTime&&(this.renderHourHand(),this.renderMinuteHand()),this.addEvents(),this.renderResult()},HaDateTimePicker.prototype.createCalendar=function(){var e=this.options.isSolar||this.options.isLunar?this.renderedDate.getFullYear().toString().toLocalDigit():this.renderedDate.getFullYear(),t=this.options.timePickerOnly?"clock timePickerOnly":"",a=this.options.disableAnimations?"no-anim":"";this.options.disableAnimations&&(this.options.pagingDuration=0);var i=this.options.isSolar?"fa":this.options.isLunar?"ar":"en",s="<div class='ha-datetimepicker "+a+" "+t+" "+i+"' id='"+this.uId+"'><div class='ha-dp-dim'></div><div class='ha-datetimepicker-container'>";s+="<div class='ha-dp-header'><div class='ha-dp-year'><div class='ha-dp-year-dropdown-container'><button type='button' class='ha-dp-year-btn'>"+e+"</button><ul class='ha-dp-year-dropdown'>";for(var o=this.options.minYear;o<=this.options.maxYear;o++){o%10==0&&(s+="<hr class='ha-dp-list-separator'/>");var n=this.options.isSolar||this.options.isLunar?o.toString().toLocalDigit():o;s+="<li class='ha-dp-year-item' data-year='"+o+"'>"+n+"</li>"}s+="</ul></div></div><div class='ha-dp-month'><button type='button' class='ha-dp-prev-btn'><</button><div class='ha-dp-month-dropdown-container'><button type='button' class='ha-dp-month-btn'>"+this.monthNames[this.renderedDate.getMonth()]+"</button><ul class='ha-dp-month-dropdown'>";for(var r=0;r<this.monthNames.length;r++)s+="<li class='ha-dp-month-item'>"+this.monthNames[r]+"</li>";s+="</ul></div><button type='button' class='ha-dp-next-btn'>></button></div></div>",s+="<div class='ha-dp-body'>",s+="<div>";for(var l=0;l<7;l++){var d=this.options.isSolar?this.days[l][0]:this.days[l];s+="<p class='ha-dp-cell ha-dp-cell-header'>"+d}s+="</div>",s+="<div class='ha-dp-days-container'></div>",s+="</div>",this.options.disableTime===!1&&(s+="<div class='ha-dp-clock'><div class='ha-dp-clock-header'><div class='ha-dp-ampm'><div type='button' class='ha-dp-clock-am-btn"+(this.selectedTime&&"am"==this.selectedTime.amOrPm.toLowerCase()||!this.selectedTime?" selected":"")+"'>AM</div><button type='button' class='ha-dp-clock-ampm-btn"+(this.selectedTime&&"pm"==this.selectedTime.amOrPm.toLowerCase()?" pm":" am")+"'>AMPM</button><div type='button' class='ha-dp-clock-pm-btn"+(this.selectedTime&&"pm"==this.selectedTime.amOrPm.toLowerCase()?" selected":"")+"'>PM</div></div></div><div class='ha-dp-clock-body'><div class='ha-dp-clock-face'><div class='hours-clock-face'></div></div></div><div class='ha-dp-clock-footer'><p class='ha-dp-clock-res'></p>",this.options.disableOkButton||(s+="<button type='button' class='ha-dp-btn ha-dp-clock-ok-btn'>OK</button>"),s+="</div></div>"),s+="<div class='ha-dp-footer'><p class='ha-dp-result'>-</p>",this.options.disableOkButton||(s+="<div class='ha-dp-buttons'><button type='button' class='ha-dp-btn ha-dp-cancel-btn'>Cancel</button><button type='button' class='ha-dp-btn ha-dp-ok-btn'>OK</button>",this.options.disableTime===!1&&(s+="<button type='button' class='ha-dp-btn ha-dp-clock-btn'>Clock</button>"),s+="</div>"),s+="</div>",s+="</div></div>";var c=createFragment(s);this.dpDOM=c,document.body.insertBefore(c,document.body.childNodes[document.body.childNodes.length-1])},HaDateTimePicker.prototype.setupStyles=function(){var e=document.querySelector(".ha-dp-days-container");if(e.setAttribute("style","animation-duration:"+this.options.pagingDuration+"ms"),this.options.isSolar||this.options.isLunar){var t=document.querySelector(".ha-dp-body");t.style.direction="rtl"}},HaDateTimePicker.prototype.renderDate=function(e){this.renderedDate=new HaDateSource(e),this.renderedDate.setDate(1);for(var t=[{daysOfWeek:[]}],a=document.querySelector(".ha-datetimepicker"),i=0;i<a.classList.length;i++)a.classList[i].indexOf("month")>=0&&a.classList.remove(a.classList[i]);a.className+=" month"+e.getMonth();var s,o;o=new HaDateSource(e.getFullYear(),e.getMonth(),1),s=new HaDateSource;for(var i=-o.getDay()+1,n=1;n<=6;n++){for(var r=new Array,l=1;l<=7;l++)r.push(i++);t.push({daysOfWeek:r})}var d=document.querySelector(".ha-dp-year-btn");d.innerHTML=this.options.isSolar||this.options.isLunar?e.getFullYear().toString().toLocalDigit():e.getFullYear();for(var c=document.getElementsByClassName("ha-dp-year-item"),h=0;h<c.length;h++)c[h].classList.contains("selected")&&c[h].classList.remove("selected");var u=document.querySelector(".ha-dp-year-item[data-year='"+e.getFullYear()+"']");null!=u&&(u.className+=" selected");var m=document.querySelector(".ha-dp-month-btn");m.innerHTML=this.monthNames[e.getMonth()];var p=document.querySelector(".ha-dp-days-container"),g=new HaDateSource,D=g.getMonthTotalDays(e.getMonth(),e.getFullYear()),v=g.getMonthTotalDays(e.getMonth()-1,e.getFullYear());delete g;for(var y="",f=0;f<t.length;f++){for(var k="<div>",b=0;b<t[f].daysOfWeek.length;b++){var S=t[f].daysOfWeek[b];if(S<=D&&S>0){var w=null!=this.selectedDate&&this.selectedDate.getFullYear()==e.getFullYear()&&this.selectedDate.getMonth()==e.getMonth()&&this.selectedDate.getDate()==S?" ha-dp-cell-selected":"",T="";if(null!=this.options.minAllowedDate&&(T=this.options.date.compare(new Date(e.getFullYear(),e.getMonth(),S),this.options.minAllowedDate)>0?" ha-dp-cell-muted":T),null!=this.options.maxAllowedDate&&(T=this.options.date.compare(new Date(e.getFullYear(),e.getMonth(),S),this.options.maxAllowedDate)<0?" ha-dp-cell-muted":T),null!=this.options.disabledWeekDays){var L=this.options.isSolar||this.options.isLunar?b:b+1;this.options.disabledWeekDays.indexOf(L)>=0&&(T=" ha-dp-cell-muted")}var H,A=s.getFullYear()==e.getFullYear()&&s.getMonth()==e.getMonth()&&s.getDate()==S?" ha-dp-cell-currentdate":"";H=this.options.isSolar||this.options.isLunar?6==b?" ha-dp-cell-holiday":"":5==b?" ha-dp-cell-holiday":"";var C=1==this.options.isSolar||this.options.isLunar?S.toString().toLocalDigit():S;k+="<p class='ha-dp-cell"+H+A+w+T+"' data-date='"+S+"' data-disp='"+C+"'>"+C+"</p>"}else if(S<1){var C=1==this.options.isSolar||this.options.isLunar?(v+S).toString().toLocalDigit():v+S;k+="<p class='ha-dp-cell ha-dp-cell-muted' data-date='"+(v+S)+"'>"+C+"</p>"}else{var C=1==this.options.isSolar||this.options.isLunar?(S-D).toString().toLocalDigit():S-D;k+="<p class='ha-dp-cell ha-dp-cell-muted' data-date='"+(S-D)+"'>"+C+"</p>"}}k+="</div>",y+=k}p.innerHTML=y,this.addEvents(),this.events.pageChanged.detail.isClock=self.clock,this.eventHandler.dispatchEvent(this.events.pageChanged)},HaDateTimePicker.prototype.changeDate=function(e){var t=document.querySelector(".ha-dp-days-container"),a=this.options.pagingDuration;t.className=t.className.replace("page-left","").replace("page-right","").trim(),this.options.date.compare(e,this.renderedDate)==-1?t.className+=" page-left":t.className+=" page-right";var i=this;setTimeout(function(){i.renderDate(new HaDateSource(e.getFullYear(),e.getMonth(),e.getDate()))},a/2),setTimeout(function(){t.className=t.className.replace("page-left","").replace("page-right","").trim()},a)},HaDateTimePicker.prototype.createEvents=function(){(function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var a=document.createEvent("CustomEvent");return a.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),a}e.prototype=window.Event.prototype,window.CustomEvent=e})(),this.events={selectedDateChanged:new CustomEvent("selectedDateChanged",{detail:{selectedDate:this.getResult()}}),selectedTimeChanged:new CustomEvent("selectedTimeChanged",{detail:{selectedTime:this.selectedTime}}),pageChanged:new CustomEvent("pageChanged",{detail:{date:this.renderedDate}}),clockToggled:new CustomEvent("clockToggled",{detail:{isClock:this.clock}}),pickerShow:new CustomEvent("pickerShow"),pickerHide:new CustomEvent("pickerHide")}},HaDateTimePicker.prototype.addEventListener=function(e,t){this.eventHandler.addEventListener(e,t)},HaDateTimePicker.prototype.addEvents=function(){for(var e=(document.querySelector(".ha-dp-days-container"),new Date),t=this,a=document.querySelectorAll("#"+this.uId+" .ha-dp-cell:not(.ha-dp-cell-muted):not(.ha-dp-cell-header)"),i=0;i<a.length;i++)a[i].onclick=function(){for(var e=0;e<a.length;e++)a[e].className=a[e].className.replace("ha-dp-cell-selected","").trim();this.className+=" ha-dp-cell-selected",t.selectedDate=new HaDateSource(t.renderedDate.getFullYear(),t.renderedDate.getMonth(),parseInt(this.getAttribute("data-date"))),t.events.selectedDateChanged.detail.selectedDate=t.selectedDate,t.eventHandler.dispatchEvent(t.events.selectedDateChanged),t.renderResult(),t.options.disableOkButton&&(t.toggleClock(),t.returnResults())};var s=document.querySelector(".ha-dp-dim");s.onclick=function(){t.hide()};var o=document.querySelector(".ha-dp-next-btn"),n=document.querySelector(".ha-dp-prev-btn");o.onclick=function(){var a=t.renderedDate.getFullYear(),i=t.renderedDate.getMonth()+1;i>=12&&(a++,i=0);var s=new HaDateSource(a,i,e.getDate());t.changeDate(s)},n.onclick=function(){var a=t.renderedDate.getFullYear(),i=t.renderedDate.getMonth()-1;i<0&&(a--,i=11),t.changeDate(new HaDateSource(a,i,e.getDate()))};var r=document.querySelector(".ha-dp-month-btn"),l=document.querySelector(".ha-dp-year-btn"),d=document.querySelector(".ha-dp-month-dropdown"),c=document.querySelector(".ha-dp-year-dropdown");document.querySelector("body").addEventListener("click",function(){d.className.indexOf("show")>-1&&(d.className=d.className.replace("show","").trim()),c.className.indexOf("show")>-1&&(c.className=c.className.replace("show","").trim())}),r.onclick=function(e){e.stopPropagation(),c.className.indexOf("show")>-1&&(c.className=c.className.replace("show","").trim()),d.className.indexOf("show")>-1?d.className=d.className.replace("show","").trim():d.className+=" show"},l.onclick=function(e){e.stopPropagation(),d.className.indexOf("show")>-1&&(d.className=d.className.replace("show","").trim()),c.className.indexOf("show")>-1?c.className=c.className.replace("show","").trim():c.className+=" show";var t=document.querySelector(".ha-dp-year-item.selected");if(null!=t){var a=Math.max(t.getAttribute("data-year")-5,document.querySelector(".ha-dp-year-item").getAttribute("data-year"));t=document.querySelector(".ha-dp-year-item[data-year='"+a+"']"),t.scrollIntoView()}};for(var h=document.querySelectorAll(".ha-dp-month-item"),u=0;u<h.length;u++)h[u].index=u,h[u].onclick=function(){if(this.index!=t.renderedDate.getMonth()){var a=this.index;t.changeDate(new Date(t.renderedDate.getFullYear(),a,e.getDate()))}};for(var m=document.querySelectorAll(".ha-dp-year-item"),p=0;p<m.length;p++)m[p].onclick=function(){var a=this.getAttribute("data-year");a!=t.renderedDate.getFullYear()&&t.changeDate(new Date(a,t.renderedDate.getMonth(),e.getDate()))};if(!this.options.disableOkButton){var g=document.querySelector(".ha-dp-ok-btn");g.onclick=function(){null!=t.returnResults()&&t.hide()};var D=document.querySelector(".ha-dp-cancel-btn");D.onclick=function(){t.hide()}}if(this.options.disableTime===!1){if(!this.options.disableOkButton){var v=document.querySelector(".ha-dp-clock-btn");v.onclick=function(){t.toggleClock()}}var y=document.querySelector(".ha-dp-clock-am-btn"),f=document.querySelector(".ha-dp-clock-pm-btn");y.onclick=function(){t.changeAmPm("am")},f.onclick=function(){t.changeAmPm("pm")};var k=document.querySelector(".ha-dp-clock-ampm-btn");if(k.onclick=function(){t.changeAmPm()},!this.options.disableOkButton){var b=document.querySelector(".ha-dp-clock-ok-btn");b.onclick=function(){t.options.timePickerOnly?t.returnResults()&&t.hide():t.toggleClock()}}var S=!1,w=document.querySelector(".hours-clock-face");w.addEventListener("mouseenter",function(){S=!0}),w.addEventListener("mouseleave",function(){S=!1}),w.onwheel=function(e){if(e.preventDefault(),e.stopPropagation(),null!=t.selectedTime){var a=Number(t.selectedTime.hour);e.wheelDelta<0||e.detail>0?t.setTime({hour:a-1}):t.setTime({hour:a+1})}};var T=document.querySelector(".ha-dp-clock-face");T.onwheel=function(e){if(e.preventDefault(),e.stopPropagation(),null!=t.selectedTime&&!S){var a=Number(t.selectedTime.minute);e.wheelDelta<0||e.detail>0?t.setTime({minute:a-1}):t.setTime({minute:a+1})}};for(var L=document.querySelectorAll(".ha-dp-clock-num.ha-dp-hour-num .num"),H=0;H<L.length;H++)L[H].onclick=function(){var e=this.getAttribute("data-hour");t.setTime({hour:e})};for(var A=document.querySelectorAll(".ha-dp-clock-num.ha-dp-minute-num .num"),H=0;H<A.length;H++)A[H].onclick=function(){var e=this.getAttribute("data-minute");t.setTime({minute:e})}}},HaDateTimePicker.prototype.setTime=function(e){this.selectedTime||(this.selectedTime={hour:0,minute:0,amOrPm:"AM"}),e.hour>11&&(e.hour=0),e.hour<0&&(e.hour=11),e.minute>59&&(e.minute=0),e.minute<0&&(e.minute=59),this.selectedTime.hour=null!=e.hour?e.hour:this.selectedTime.hour,this.selectedTime.minute=null!=e.minute?e.minute:this.selectedTime.minute,this.selectedTime.amOrPm=null!=e.amOrPm?e.amOrPm:this.selectedTime.amOrPm,this.renderMinuteHand(),this.renderHourHand(),this.events.selectedTimeChanged.detail.selectedTime=this.selectedTime,this.eventHandler.dispatchEvent(this.events.selectedTimeChanged)},HaDateTimePicker.prototype.toggleClock=function(){if(this.options.disableTime!==!0){var e=document.querySelector(".ha-datetimepicker");this.clock?e.className=e.className.replace("clock","").trim():e.className+=" clock",this.clock=!this.clock,this.events.clockToggled.detail.isClock=this.clock,this.eventHandler.dispatchEvent(this.events.clockToggled),this.renderResult()}},HaDateTimePicker.prototype.renderResult=function(){var e=document.querySelector(".ha-dp-result"),t="";null!=this.selectedDate&&(t=this.options.isSolar||this.options.isLunar?this.selectedDate.getDate()+"/"+(this.selectedDate.getMonth()+1)+"/"+this.selectedDate.getFullYear():this.selectedDate.getMonth()+1+"/"+this.selectedDate.getDate()+"/"+this.selectedDate.getFullYear()),null!=this.selectedTime&&(t+=" "+twoDigits(this.getHours())+":"+twoDigits(this.getMinutes())+" "+this.getAmOrPm().toUpperCase()),e.innerHTML=""==t?"-":this.options.isSolar||this.options.isLunar?t.toLocalDigit():t},HaDateTimePicker.prototype.renderHourHand=function(){if(this.options.disableTime!==!0){for(var e=this.selectedTime.hour,t=document.querySelector(".hours-clock-face"),a=document.querySelector(".ha-dp-clock-hour-hand"),i=document.querySelectorAll(".ha-dp-clock-num.ha-dp-hour-num .num.selected"),s=0;s<i.length;s++)i[s].classList.remove("selected");document.querySelector(".ha-datetimepicker [data-hour='"+this.selectedTime.hour+"']").className+=" selected";var o;o=null!=a?a:document.createElement("div"),o.className="ha-dp-clock-hour-hand";var n=180+30*e+.5*this.selectedTime.minute;o.setAttribute("style","-webkit-transform: rotateZ("+n+"deg);-moz-transform: rotateZ("+n+"deg);transform: rotateZ("+n+"deg);"),null==a&&t.appendChild(o),this.renderClockResult()}},HaDateTimePicker.prototype.renderMinuteHand=function(){if(this.options.disableTime!==!0){for(var e=this.selectedTime.minute,t=document.querySelectorAll(".ha-dp-clock-num.ha-dp-minute-num .num.selected"),a=0;a<t.length;a++)t[a].classList.remove("selected");document.querySelector(".ha-datetimepicker [data-minute='"+this.selectedTime.minute+"']").className+=" selected";var i,s=document.querySelector(".ha-dp-clock-face"),o=document.querySelector(".ha-dp-clock-minute-hand");i=null!=o?o:document.createElement("div"),i.className="ha-dp-clock-minute-hand";var n=180+6*e;i.setAttribute("style","-webkit-transform: rotateZ("+n+"deg);-moz-transform: rotateZ("+n+"deg);transform: rotateZ("+n+"deg);"),null==o&&s.appendChild(i),this.renderClockResult()}},HaDateTimePicker.prototype.renderClockResult=function(){if(this.options.disableTime!==!0){var e=document.querySelector(".ha-dp-clock-res");e.innerHTML=twoDigits(this.getHours())+":"+twoDigits(this.getMinutes())+" "+this.getAmOrPm().toUpperCase(),this.options.disableOkButton&&this.returnResults()}},HaDateTimePicker.prototype.changeAmPm=function(e){if(this.options.disableTime!==!0&&null!=this.selectedTime){var t=document.querySelector(".ha-dp-clock-ampm-btn"),a=document.querySelector(".ha-dp-clock-am-btn"),i=document.querySelector(".ha-dp-clock-pm-btn");(null==e||"am"!=e.toLowerCase()&&"pm"!=e.toLowerCase())&&(e=null==this.selectedTime?"am":"am"===this.selectedTime.amOrPm.toLowerCase()?"pm":"am"),this.selectedTime.amOrPm=e,"am"==e.toLowerCase()?(i.classList.remove("selected"),a.classList.add("selected")):(a.classList.remove("selected"),i.classList.add("selected")),t.classList.remove("am"),t.classList.remove("pm"),t.classList.add(e),this.renderClockResult(),this.events.selectedTimeChanged.detail.selectedTime=this.selectedTime,this.eventHandler.dispatchEvent(this.events.selectedTimeChanged)}},HaDateTimePicker.prototype.getHours=function(){var e=this.selectedTime.hour;return"pm"==this.selectedTime.amOrPm.toLowerCase()&&0==e&&(e=12),e},HaDateTimePicker.prototype.getMinutes=function(){return this.selectedTime.minute},HaDateTimePicker.prototype.getAmOrPm=function(){return this.selectedTime.amOrPm},HaDateTimePicker.prototype.renderClock=function(){if(this.options.disableTime!==!0){for(var e=document.querySelector(".ha-dp-clock-face"),t=document.querySelector(".hours-clock-face"),a=0;a<12;a++){var i=document.createElement("div");i.className="ha-dp-clock-num ha-dp-hour-num";var s=document.createElement("span");s.setAttribute("data-hour",a),s.className="num",s.innerHTML=0==a?12:a,i.appendChild(s);var o=180+30*a;i.setAttribute("style","-webkit-transform: rotateZ("+o+"deg);-moz-transform: rotateZ("+o+"deg);transform: rotateZ("+o+"deg);"),s.setAttribute("style","-webkit-transform: rotateZ("+-o+"deg);-moz-transform: rotateZ("+-o+"deg);transform: rotateZ("+-o+"deg);"),t.appendChild(i)}for(var n=0;n<60;n++){var i=document.createElement("div");i.className="ha-dp-clock-num ha-dp-minute-num";var s=document.createElement("span");s.setAttribute("data-minute",n),s.className="num",s.innerHTML=n%5==0?0==n||5==n?"0"+n:n:"•",s.className+=n%5!=0?" dot":"",i.appendChild(s);var o=180+6*n;i.setAttribute("style","-webkit-transform: rotateZ("+o+"deg);-moz-transform: rotateZ("+o+"deg);transform: rotateZ("+o+"deg);"),s.setAttribute("style","-webkit-transform: rotateZ("+-o+"deg);-moz-transform: rotateZ("+-o+"deg);transform: rotateZ("+-o+"deg);"),e.appendChild(i)}}},HaDateTimePicker.prototype.returnResults=function(){if(!this.options.timePickerOnly&&null==this.selectedDate||this.options.timePickerOnly&&null==this.selectedTime)return null;if(this.options.forceSetTime&&!this.selectedTime)return this.toggleClock(),null;for(var e=this.target.nodeType?[this.target]:document.querySelectorAll(this.target),t=this.getFormatedResult(),a=0;a<e.length;a++){var i=e[a];"input"==i.tagName.toLowerCase()?i.value=t:i.innerHTML=t}if(this.options.extraTargets)for(var s=document.querySelectorAll(this.options.extraTargets),o=this.getResult("gregorian"),n=this.getExtraTargetsResultString(o),r=0;r<s.length;r++)"input"==s[r].tagName.toLowerCase()?s[r].value=n:s[r].innerHTML=n;if(this.options.extraLunarTargets)for(var l=document.querySelectorAll(this.options.extraLunarTargets),d=this.getResult("lunar"),c=this.getExtraTargetsResultString(d),h=0;h<l.length;h++)"input"==l[h].tagName.toLowerCase()?l[h].value=c:l[h].innerHTML=c;if(this.options.extraSolarTargets)for(var u=document.querySelectorAll(this.options.extraSolarTargets),m=this.getResult("solar"),p=this.getExtraTargetsResultString(m),g=0;g<u.length;g++)"input"==u[g].tagName.toLowerCase()?u[g].value=p:u[g].innerHTML=p;return t},HaDateTimePicker.prototype.getExtraTargetsResultString=function(e){var t="";return this.options.timePickerOnly||(t+=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()),null==this.selectedTime||this.options.disableTime||(t+=" "+twoDigits(e.getHours())+":"+twoDigits(e.getMinutes())+" "+this.selectedTime.amOrPm),t.trim()},HaDateTimePicker.prototype.getResult=function(e){var t=this.options.timePickerOnly?new Date:this.selectedDate,a=new HaDateSource;if((this.options.isSolar||this.options.isLunar)&&(t=a.convertToGregorian(this.selectedDate)),null!=e){if("solar"==e.toLowerCase()){var i=new HaSolarDate;t=i.convertFromGregorian(t),delete i}else if("lunar"==e.toLowerCase()){var i=new HaLunarDate;t=i.convertFromGregorian(t),delete i}}else if(this.options.resultInSolar||this.options.resultInLunar){var s=this.options.resultInSolar?this.solarDate:this.lunarDate;t=s.convertFromGregorian(t)}return delete a,null!=this.selectedTime&&(t.setHours(this.getHours()),t.setMinutes(this.getMinutes())),t},HaDateTimePicker.prototype.getFormatedResult=function(){var e=this.getResult(),t=this.options.resultFormat;this.options.timePickerOnly&&(t=t.replace("{month}","").replace("{day}","").replace("{year}",""));do{var a=t.indexOf("{t?"),i=t.indexOfClosingSymbol(a,"{","}"),s="";a>=0&&(s=t.substr(a,i-a+1),t=null==this.selectedTime?t.replace(s,""):t.removeCharsAt(i).removeCharsAt(a,3))}while(a>=0);do{var o=t.indexOf("{month}")<0&&t.indexOf("{year}")<0&&t.indexOf("{day}")<0;t=t.replace("{month}",e.getMonth()+1).replace("{day}",e.getDate()).replace("{year}",e.getFullYear())}while(!o);do{var n=t.indexOf("{minute}")<0&&t.indexOf("{hour}")<0&&t.indexOf("{ampm}")<0;t=null!=this.selectedTime?t.replace("{hour}",twoDigits(this.getHours())).replace("{minute}",twoDigits(this.getMinutes())).replace("{ampm}",this.getAmOrPm().toUpperCase()):t.replace("{hour}","").replace("{minute}","").replace("{ampm}","")}while(!n);return t.trim()},HaDateTimePicker.prototype.show=function(){this.init();var e=this;setTimeout(function(){document.querySelector(".ha-datetimepicker").className+=" show",e.eventHandler.dispatchEvent(e.events.pickerShow)},10)},HaDateTimePicker.prototype.hide=function(){var e=document.querySelector(".ha-datetimepicker");e.className=e.className.replace("show","").trim(),this.clock=!1,this.eventHandler.dispatchEvent(this.events.pickerHide)};var dps=[];HaDateTimePicker.init=function(){for(var e=document.querySelectorAll("[data-ha-datetimepicker]"),t=0;t<e.length;t++){e[t].addEventListener("mousedown",function(){this.blur()}),e[t].addEventListener("keydown",function(e){return e.preventDefault(),!1});var a=caseInsensitiveGetAttribute(e[t],"data-ha-dp-issolar"),i=caseInsensitiveGetAttribute(e[t],"data-ha-dp-islunar"),s=caseInsensitiveGetAttribute(e[t],"data-ha-dp-resultinsolar"),o=caseInsensitiveGetAttribute(e[t],"data-ha-dp-resultinlunar"),n=new HaDateTimePicker(caseInsensitiveGetAttribute(e[t],"data-ha-datetimepicker"),{date:caseInsensitiveGetAttribute(e[t],"data-ha-dp-date"),selectedDate:e[t].value?e[t].value:e[t].innerHTML?e[t].innerHTML:caseInsensitiveGetAttribute(e[t],"data-ha-dp-selecteddate"),minAllowedDate:caseInsensitiveGetAttribute(e[t],"data-ha-dp-minalloweddate"),maxAllowedDate:caseInsensitiveGetAttribute(e[t],"data-ha-dp-maxalloweddate"),pagingDuration:caseInsensitiveGetAttribute(e[t],"data-ha-dp-pagingduration"),minYear:caseInsensitiveGetAttribute(e[t],"data-ha-dp-minyear"),maxYear:caseInsensitiveGetAttribute(e[t],"data-ha-dp-maxyear"),resultInSolar:s,resultInLunar:o,isSolar:a,isLunar:i,extraTargets:caseInsensitiveGetAttribute(e[t],"data-ha-dp-extratargets"),extraSolarTargets:caseInsensitiveGetAttribute(e[t],"data-ha-dp-extrasolartargets"),extraLunarTargets:caseInsensitiveGetAttribute(e[t],"data-ha-dp-extralunartargets"),forceSetTime:caseInsensitiveGetAttribute(e[t],"data-ha-dp-forcesettime"),disableTime:caseInsensitiveGetAttribute(e[t],"data-ha-dp-disabletime"),timePickerOnly:caseInsensitiveGetAttribute(e[t],"data-ha-dp-timepickeronly"),resultFormat:caseInsensitiveGetAttribute(e[t],"data-ha-dp-resultformat"),disabledWeekDays:caseInsensitiveGetAttribute(e[t],"data-ha-dp-disabledweekdays"),disableOkButton:caseInsensitiveGetAttribute(e[t],"data-ha-dp-disableokbutton"),disableAnimations:caseInsensitiveGetAttribute(e[t],"data-ha-dp-disableanimations")});dps.push(n),e[t].index=t,e[t].addEventListener("click",function(e){this.blur(),dps[this.index].show()})}},String.prototype.indexOfAfter=function(e,t){return preIndex=this.indexOf(e),preIndex+this.substring(preIndex).indexOf(t)},String.prototype.removeCharsAt=function(e,t){return t=t||1,this.slice(0,e)+this.slice(e+t)},String.prototype.indexOfClosingSymbol=function(e,t,a){t=t||"{",a=a||"}";for(var i=0,s=e;s<this.length;s++)if(this[s]==t&&i++,this[s]==a&&i--,i<=0)return s;return-1},Date.prototype.getMonthTotalDays=function(e,t){new Date;e+1>11&&t++;var a=new Date(t,e+1,0).getDate();return a},Date.prototype.compare=function(e,t){return null==e?0:(null==t&&(t=e,e=this),e.getFullYear()>t.getFullYear()?-1:e.getFullYear()<t.getFullYear()?1:e.getMonth()>t.getMonth()?-1:e.getMonth()<t.getMonth()?1:e.getDate()>t.getDate()?-1:e.getDate()<t.getDate()?1:0)},HaDateTimePicker.init();